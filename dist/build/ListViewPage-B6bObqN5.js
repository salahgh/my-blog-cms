import{u as v,s as _,aA as xe,q as H,dp as je,r as C,ez as re,bm as le,dI as ye,b4 as oe,eA as be,e2 as G,j as e,cE as N,eB as Ce,a0 as Se,a2 as Le,a3 as Me,eC as Ae,eD as Ie,cp as I,cy as Te,h as S,b9 as Y,eE as Z,eF as ce,l as O,o as J,dY as de,an as K,aN as Re,eG as Fe,as as P,M as Ee,eH as q,c as ue,eI as z,I as we,cq as ke,p as ve,aD as V,at as Pe,eJ as Oe,e8 as pe,dJ as Be,aL as De,bo as $e,aw as He,a as Ne,b as Ue,eK as me,ch as Ve,e9 as We,eL as _e,dO as qe,a7 as ze,ds as Qe,d as k,bi as X,L as $,eM as ee,am as Ge,E as Ye,Q as Je,bA as b,bY as Ke,eN as Ze,cF as Q,bb as Xe,e0 as et,e6 as tt,Y as st,ba as nt,au as at,eO as it,eP as rt,eQ as lt}from"./strapi-Bz8I0DhC.js";import{S as te}from"./SearchInput-BCMgzGut.js";import{u as ot}from"./hooks-CdHbjq_a.js";const se=["json","component","media","richtext","dynamiczone","password","blocks"],ct=["createdAt","updatedAt"],dt=[...re,"strapi_assignee"],ne=({disabled:t,schema:n})=>{const{attributes:s,uid:a,options:l}=n,{formatMessage:o,locale:j}=v(),{trackUsage:d}=_(),i=xe("FiltersImpl",h=>h.permissions),[{query:g}]=H(),{schemas:u}=je(),L=C.useMemo(()=>i.filter(h=>h.action==="admin::users.read"&&h.subject===null).length>0,[i]),M=(g?.filters?.$and??[]).reduce((h,F)=>{const[f,x]=Object.entries(F)[0];if(typeof x.id!="object")return h;const r=x.id.$eq||x.id.$ne;return r&&dt.includes(f)&&!h.includes(r)&&h.push(r),h},[]),{data:y,isLoading:p}=le({filters:{id:{$in:M}}},{skip:M.length===0||!L}),{users:m=[]}=y??{},{metadata:T}=ye(a,{selectFromResult:({data:h})=>({metadata:h?.contentType.metadatas??{}})}),B=oe(j,{sensitivity:"base"}),R=C.useMemo(()=>{const[{properties:{fields:h=[]}={fields:[]}}]=i.filter(f=>f.action==="plugin::content-manager.explorer.read"&&f.subject===a);return["id","documentId",...h.filter(f=>{const x=s[f]??{};return x.type&&!se.includes(x.type)}),...ct,...L?re:[]].map(f=>{const x=s[f];if(se.includes(x.type))return null;const{mainField:r="",label:E}=T[f].list;let c={name:f,label:E??"",mainField:be(x,r,{schemas:u,components:{}}),type:x.type};return x.type==="relation"&&"target"in x&&x.target==="admin::user"&&(c={...c,input:ut,options:m.map(w=>({label:G(w),value:w.id.toString()})),operators:[{label:o({id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"}),value:"$eq"},{label:o({id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"}),value:"$ne"}],mainField:{name:"id",type:"integer"}}),x.type==="enumeration"&&(c={...c,options:x.enum.map(w=>({label:w,value:w}))}),c}).filter(Boolean).toSorted((f,x)=>B.compare(f.label,x.label))},[i,L,a,s,T,u,m,o,B]),A=h=>{h&&d("willFilterEntries")},D=h=>{const F=s[h.name];F&&d("didFilterEntries",{useRelation:F.type==="relation"})};return e.jsxs(N.Root,{disabled:t,options:R,onOpenChange:A,onChange:D,children:[e.jsx(N.Trigger,{}),e.jsx(N.Popover,{}),e.jsx(N.List,{})]})},ut=({name:t})=>{const[n,s]=C.useState(10),[a,l]=C.useState(""),{formatMessage:o}=v(),j=Ce(a,300),{data:d,isLoading:i}=le({pageSize:n,_q:j}),g=Se(t),u=m=>{m||s(10)},{users:L=[],pagination:M}=d??{},{pageCount:y=1,page:p=1}=M??{};return e.jsx(Le,{value:g.value,"aria-label":o({id:"content-manager.components.Filters.usersSelect.label",defaultMessage:"Search and select a user to filter"}),onOpenChange:u,onChange:m=>g.onChange(t,m),loading:i,onLoadMore:()=>s(n+10),hasMoreItems:p<y,onInputChange:m=>{l(m.currentTarget.value)},children:L.map(m=>e.jsx(Me,{value:m.id.toString(),children:G(m)},m.id))})},W=({type:t,value:n})=>{const{formatDate:s,formatTime:a,formatNumber:l}=v();let o=n;if(t==="date"&&(o=s(Ae(n),{dateStyle:"full"})),t==="datetime"&&(o=s(n,{dateStyle:"full",timeStyle:"short"})),t==="time"){const[j,d,i]=n.split(":"),g=new Date;g.setHours(j),g.setMinutes(d),g.setSeconds(i),o=a(g,{timeStyle:"short"})}return["float","decimal"].includes(t)&&(o=l(n,{maximumFractionDigits:20})),["integer","biginteger"].includes(t)&&(o=l(n,{maximumFractionDigits:0})),Ie(o)},pt=({content:t,mainField:n})=>n?e.jsx(Y,{label:t[n.name],children:e.jsx(S,{maxWidth:"25rem",textColor:"neutral800",ellipsis:!0,children:e.jsx(W,{type:n.type,value:t[n.name]})})}):null,mt=({content:t,mainField:n})=>{const{formatMessage:s}=v();return n?e.jsxs(I.Root,{children:[e.jsxs(I.Trigger,{onClick:a=>a.stopPropagation(),children:[e.jsx(Te,{children:t.length}),s({id:"content-manager.containers.list.items",defaultMessage:"{number, plural, =0 {items} one {item} other {items}}"},{number:t.length})]}),e.jsx(I.Content,{children:t.map(a=>e.jsx(I.Item,{disabled:!0,children:e.jsx(S,{maxWidth:"50rem",ellipsis:!0,children:e.jsx(W,{type:n.type,value:a[n.name]})})},a.id))})]}):null},gt=t=>t&&t[0]==="."?t.substring(1):t,ge=({url:t,mime:n,alternativeText:s,name:a,ext:l,formats:o})=>{const j=Z(t);if(n.includes("image")){const g=o?.thumbnail?.url,u=Z(g)||j;return e.jsx(ce.Item,{src:u,alt:s||a,fallback:s||a,preview:!0})}const d=gt(l),i=a.length>100?`${a.substring(0,100)}...`:a;return e.jsx(Y,{description:i,children:e.jsx(he,{children:d})})},he=({children:t})=>e.jsx(O,{tag:"span",position:"relative",borderRadius:"50%",width:"26px",height:"26px",borderColor:"neutral200",background:"neutral150",paddingLeft:"1px",justifyContent:"center",alignItems:"center",children:e.jsx(ht,{variant:"sigma",textColor:"neutral600",children:t})}),ht=J(S)`
  font-size: 0.9rem;
  line-height: 0.9rem;
`,ft=({content:t})=>e.jsx(ce.Group,{children:t.map((n,s)=>{const a=`${n.id}${s}`;if(s===3){const l=`+${t.length-3}`;return e.jsx(he,{children:l},a)}return s>3?null:e.jsx(ge,{...n},a)})}),xt=({mainField:t,content:n})=>e.jsx(S,{maxWidth:"50rem",textColor:"neutral800",ellipsis:!0,children:de(n,t)}),jt=({mainField:t,content:n,rowId:s,name:a})=>{const{model:l}=K(),{formatMessage:o}=v(),{notifyStatus:j}=Re(),[d,i]=C.useState(!1),[g]=a.split("."),{data:u,isLoading:L}=Fe({model:l,id:s,targetField:g},{skip:!d,refetchOnMountOrArgChange:!0}),M=Array.isArray(n)?n.length:n.count;return C.useEffect(()=>{u&&j(o({id:P("DynamicTable.relation-loaded"),defaultMessage:"Relations have been loaded"}))},[u,o,j]),e.jsxs(I.Root,{onOpenChange:y=>i(y),children:[e.jsx(I.Trigger,{onClick:y=>y.stopPropagation(),children:e.jsx(S,{style:{cursor:"pointer"},textColor:"neutral800",fontWeight:"regular",children:M>0?o({id:"content-manager.containers.list.items",defaultMessage:"{number} {number, plural, =0 {items} one {item} other {items}}"},{number:M}):"-"})}),e.jsxs(I.Content,{children:[L&&e.jsx(I.Item,{disabled:!0,children:e.jsx(Ee,{small:!0,children:o({id:P("ListViewTable.relation-loading"),defaultMessage:"Relations are loading"})})}),u?.results&&e.jsxs(e.Fragment,{children:[u.results.map(y=>e.jsx(I.Item,{children:e.jsx(S,{maxWidth:"50rem",ellipsis:!0,children:de(y,t)})},y.documentId)),u?.pagination&&u?.pagination.total>10&&e.jsx(I.Item,{"aria-disabled":!0,"aria-label":o({id:P("ListViewTable.relation-more"),defaultMessage:"This relation contains more entities than displayed"}),children:e.jsx(S,{children:"â€¦"})})]})]})]})},yt=({content:t,mainField:n,attribute:s,rowId:a,name:l})=>{if(!bt(t,n,s))return e.jsx(S,{textColor:"neutral800",paddingLeft:s.type==="relation"?"1.6rem":0,paddingRight:s.type==="relation"?"1.6rem":0,children:"-"});switch(s.type){case"media":return s.multiple?e.jsx(ft,{content:t}):e.jsx(ge,{...t});case"relation":return fe(s.relation)?e.jsx(xt,{mainField:n,content:t}):e.jsx(jt,{rowId:a,mainField:n,content:t,name:l});case"component":return s.repeatable?e.jsx(mt,{mainField:n,content:t}):e.jsx(pt,{mainField:n,content:t});case"string":return e.jsx(Y,{description:t,children:e.jsx(S,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(W,{type:s.type,value:t})})});default:return e.jsx(S,{maxWidth:"30rem",ellipsis:!0,textColor:"neutral800",children:e.jsx(W,{type:s.type,value:t})})}},bt=(t,n,s)=>{if(s.type==="component"){if(s.repeatable||!n)return t?.length>0;const a=t?.[n.name];return n.name==="id"&&![void 0,null].includes(a)?!0:!q(a)}return s.type==="relation"?fe(s.relation)?!q(t):Array.isArray(t)?t.length>0:t?.count>0:["integer","decimal","float","number"].includes(s.type)?typeof t=="number":s.type==="boolean"?t!==null:!q(t)},fe=t=>["oneToOne","manyToOne","oneToOneMorph"].includes(t),ae=t=>{const n=ot(o=>o.admin_app.permissions.contentManager?.collectionTypesConfigurations??[]),[{query:s}]=H(),{formatMessage:a}=v(),{allowedActions:{canConfigureView:l}}=ue(n);return e.jsxs(z.Root,{children:[e.jsx(z.Trigger,{children:e.jsx(we,{label:a({id:"components.ViewSettings.tooltip",defaultMessage:"View Settings"}),children:e.jsx(ke,{})})}),e.jsx(z.Content,{side:"bottom",align:"end",sideOffset:4,children:e.jsxs(O,{alignItems:"stretch",direction:"column",padding:3,gap:3,children:[l?e.jsx(ve,{size:"S",startIcon:e.jsx(Oe,{}),variant:"secondary",tag:Pe,to:{pathname:"configurations/list",search:s.plugins?V.stringify({plugins:s.plugins},{encode:!1}):""},children:a({id:"app.links.configure-view",defaultMessage:"Configure the view"})}):null,e.jsx(Ct,{...t})]})})]})},Ct=({headers:t=[],resetHeaders:n,setHeaders:s})=>{const{trackUsage:a}=_(),{formatMessage:l,locale:o}=v(),{schema:j,model:d}=K(),{list:i}=pe(d),g=oe(o,{sensitivity:"base"}),u=j?.attributes??{},L=Object.keys(u).filter(p=>Be(u[p])).map(p=>({name:p,label:i.metadatas[p]?.label??""})).sort((p,m)=>g.compare(p.label,m.label)),M=p=>{a("didChangeDisplayedFields");const m=t.includes(p)?t.filter(T=>T!==p):[...t,p];s(m)},y=()=>{n()};return e.jsxs(O,{tag:"fieldset",direction:"column",alignItems:"stretch",gap:3,borderWidth:0,maxHeight:"240px",overflow:"scroll",children:[e.jsxs(O,{justifyContent:"space-between",children:[e.jsx(S,{tag:"legend",variant:"pi",fontWeight:"bold",children:l({id:"containers.list.displayedFields",defaultMessage:"Displayed fields"})}),e.jsx(De,{onClick:y,children:l({id:"app.components.Button.reset",defaultMessage:"Reset"})})]}),e.jsx(O,{direction:"column",alignItems:"stretch",children:L.map(p=>{const m=t.includes(p.name);return e.jsx(O,{wrap:"wrap",gap:2,background:m?"primary100":"transparent",hasRadius:!0,padding:2,children:e.jsx($e,{onCheckedChange:()=>M(p.name),checked:m,name:p.name,children:e.jsx(S,{fontSize:1,children:p.label})})},p.name)})})]})},{INJECT_COLUMN_IN_TABLE:St}=Qe,ie=J($.Header)`
  overflow-wrap: anywhere;
`,Lt=()=>{const{trackUsage:t}=_(),n=He(),{formatMessage:s}=v(),{toggleNotification:a}=Ne(),{_unstableFormatAPIError:l}=Ue(P),{collectionType:o,model:j,schema:d}=K(),{list:i}=pe(j),[g,u]=C.useState([]),L=me(i.layout);C.useEffect(()=>{Ve(L,i.layout)||u(i.layout)},[i.layout,L]);const M=r=>{u(it(r,d.attributes,i.metadatas))},[{query:y}]=H({page:"1",pageSize:i.settings.pageSize.toString(),sort:i.settings.defaultSortBy?`${i.settings.defaultSortBy}:${i.settings.defaultSortOrder}`:""}),p=C.useMemo(()=>We(y),[y]),{data:m,error:T,isFetching:B}=_e({model:j,params:p});C.useEffect(()=>{T&&a({type:"danger",message:l(T)})},[T,l,a]);const{results:R=[],pagination:A}=m??{};C.useEffect(()=>{A&&A.pageCount>0&&A.page>A.pageCount&&n({search:V.stringify({...y,page:A.pageCount})},{replace:!0})},[A,s,y,n]);const{canCreate:D}=qe("ListViewPage",({canCreate:r})=>({canCreate:r})),h=ze("ListViewPage",({runHookWaterfall:r})=>r),F=C.useMemo(()=>{const E=h(St,{displayedHeaders:g,layout:i}).displayedHeaders.map(c=>{const w=typeof c.label=="string"?{id:`content-manager.content-types.${j}.${c.name}`,defaultMessage:c.label}:c.label;return{...c,label:s(w),name:`${c.name}${c.mainField?.name?`.${c.mainField.name}`:""}`}});return d?.options?.draftAndPublish&&E.push({attribute:{type:"custom"},name:"status",label:s({id:P("containers.list.table-headers.status"),defaultMessage:"status"}),searchable:!1,sortable:!1}),E},[g,s,i,h,d?.options?.draftAndPublish,j]);if(B)return e.jsx(k.Loading,{});if(T)return e.jsx(k.Error,{});const f=d?.info.displayName?s({id:d.info.displayName,defaultMessage:d.info.displayName}):s({id:"content-manager.containers.untitled",defaultMessage:"Untitled"}),x=r=>()=>{t("willEditEntryFromList"),n({pathname:r.toString(),search:V.stringify({plugins:y.plugins})})};return!B&&R.length===0?e.jsxs(k.Main,{children:[e.jsx(k.Title,{children:`${f}`}),e.jsx(ie,{primaryAction:D?e.jsx(U,{}):null,subtitle:s({id:P("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:A?.total}),title:f,navigationAction:e.jsx(X,{})}),e.jsx($.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(ee,{area:"listView.actions"}),e.jsx(ae,{setHeaders:M,resetHeaders:()=>u(i.layout),headers:g.map(r=>r.name)})]}),startActions:e.jsxs(e.Fragment,{children:[i.settings.searchable&&e.jsx(te,{disabled:R.length===0,label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:f}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),i.settings.filterable&&d?e.jsx(ne,{disabled:R.length===0,schema:d}):null]})}),e.jsx($.Content,{children:e.jsx(Ge,{background:"neutral0",shadow:"filterShadow",hasRadius:!0,children:e.jsx(Ye,{action:D?e.jsx(U,{variant:"secondary"}):null,content:s({id:"app.components.EmptyStateLayout.content-document",defaultMessage:"No content found"}),hasRadius:!0,icon:e.jsx(Je,{width:"16rem"})})})})]}):e.jsxs(k.Main,{children:[e.jsx(k.Title,{children:`${f}`}),e.jsx(ie,{primaryAction:D?e.jsx(U,{}):null,subtitle:s({id:P("pages.ListView.header-subtitle"),defaultMessage:"{number, plural, =0 {# entries} one {# entry} other {# entries}} found"},{number:A?.total}),title:f,navigationAction:e.jsx(X,{})}),e.jsx($.Action,{endActions:e.jsxs(e.Fragment,{children:[e.jsx(ee,{area:"listView.actions"}),e.jsx(ae,{setHeaders:M,resetHeaders:()=>u(i.layout),headers:g.map(r=>r.name)})]}),startActions:e.jsxs(e.Fragment,{children:[i.settings.searchable&&e.jsx(te,{disabled:R.length===0,label:s({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:f}),placeholder:s({id:"global.search",defaultMessage:"Search"}),trackedEvent:"didSearch"}),i.settings.filterable&&d?e.jsx(ne,{disabled:R.length===0,schema:d}):null]})}),e.jsx($.Content,{children:e.jsxs(O,{gap:4,direction:"column",alignItems:"stretch",children:[e.jsxs(b.Root,{rows:R,headers:F,isLoading:B,children:[e.jsx(At,{}),e.jsxs(b.Content,{children:[e.jsxs(b.Head,{children:[e.jsx(b.HeaderCheckboxCell,{}),F.map(r=>e.jsx(b.HeaderCell,{...r},r.name))]}),e.jsx(b.Loading,{}),e.jsx(b.Empty,{action:D?e.jsx(U,{variant:"secondary"}):null}),e.jsx(b.Body,{children:R.map(r=>e.jsxs(b.Row,{cursor:"pointer",onClick:x(r.documentId),children:[e.jsx(b.CheckboxCell,{id:r.id}),F.map(({cellFormatter:E,...c})=>{if(c.name==="status"){const{status:w}=r;return e.jsx(b.Cell,{children:e.jsx(Ke,{status:w,maxWidth:"min-content"})},c.name)}return["createdBy","updatedBy"].includes(c.name.split(".")[0])?e.jsx(b.Cell,{children:e.jsx(S,{textColor:"neutral800",children:r[c.name.split(".")[0]]?G(r[c.name.split(".")[0]]):"-"})},c.name):typeof E=="function"?e.jsx(b.Cell,{children:E(r,c,{collectionType:o,model:j})},c.name):e.jsx(b.Cell,{children:e.jsx(yt,{content:r[c.name.split(".")[0]],rowId:r.documentId,...c})},c.name)}),e.jsx(Mt,{onClick:E=>E.stopPropagation(),children:e.jsx(Ze,{document:r})})]},r.id))})]})]}),e.jsxs(Q.Root,{...A,onPageSizeChange:()=>t("willChangeNumberOfEntriesPerPage"),children:[e.jsx(Q.PageSize,{}),e.jsx(Q.Links,{})]})]})})]})},Mt=J(b.Cell)`
  display: flex;
  justify-content: flex-end;
`,At=()=>{const t=rt("TableActionsBar",l=>l.selectRow),[{query:n}]=H(),s=n?.plugins?.i18n?.locale,a=me(s);return C.useEffect(()=>{a!==s&&t([])},[t,a,s]),e.jsx(b.ActionBar,{children:e.jsx(lt,{})})},U=({variant:t})=>{const{formatMessage:n}=v(),{trackUsage:s}=_(),[{query:a}]=H();return e.jsx(st,{variant:t,tag:nt,onClick:()=>{s("willCreateEntry",{status:"draft"})},startIcon:e.jsx(at,{}),style:{textDecoration:"none"},to:{pathname:"create",search:V.stringify({plugins:a.plugins})},minWidth:"max-content",marginLeft:2,children:n({id:P("HeaderLayout.button.label-add-entry"),defaultMessage:"Create new entry"})})},Ft=()=>{const{slug:t=""}=Xe(),{permissions:n=[],isLoading:s,error:a}=ue(et.map(l=>({action:l,subject:t})));return s?e.jsx(k.Loading,{}):a||!t?e.jsx(k.Error,{}):e.jsx(k.Protect,{permissions:n,children:({permissions:l})=>e.jsx(tt,{permissions:l,children:e.jsx(Lt,{})})})};export{Lt as ListViewPage,Ft as ProtectedListViewPage};
