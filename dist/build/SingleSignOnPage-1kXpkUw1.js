import{aM as j,j as s,d as g,u as v,a as A,b as F,aZ as k,a_ as C,c as E,L as p,W as O,aQ as T,X as q,Y as _,Z as V,l as $,h as z,_ as x,a$ as B,b0 as R,b1 as H,aS as f,aU as U,aV as G,a0 as Q,a1 as c,b2 as D,b3 as N}from"./strapi-Bz8I0DhC.js";import{u as W}from"./useAdminRoles-CJMkUPE4.js";const Z=T().shape({autoRegister:H().required(f.required),defaultRole:R().when("autoRegister",(e,t)=>e?t.required(f.required):t.nullable()),ssoLockedRoles:B().nullable().of(R().when("ssoLockedRoles",(e,t)=>e?t.required(f.required):t.nullable()))}),X=()=>{const{formatMessage:e}=v(),t=j(l=>l.admin_app.permissions),{toggleNotification:o}=A(),{_unstableFormatAPIError:m,_unstableFormatValidationErrors:h}=F(),{isLoading:i,data:n}=k(),[d,{isLoading:M}]=C(),{isLoading:y,allowedActions:{canUpdate:L,canRead:I}}=E({...t.settings?.sso,readRoles:t.settings?.roles.read??[]}),{roles:S,isLoading:P}=W(void 0,{skip:!I}),w=async(l,u)=>{try{const a=await d(l);if("error"in a){U(a.error)&&a.error.name==="ValidationError"?u.setErrors(h(a.error)):o({type:"danger",message:m(a.error)});return}o({type:"success",message:e({id:"notification.success.saved"})})}catch{o({type:"danger",message:e({id:"notification.error",defaultMessage:"An error occurred, please try again."})})}},b=P||y||i;return s.jsxs(p.Root,{children:[s.jsx(g.Title,{children:e({id:"Settings.PageTitle",defaultMessage:"Settings - {name}"},{name:"SSO"})}),s.jsx(g.Main,{"aria-busy":M||b,tabIndex:-1,children:s.jsx(O,{method:"PUT",onSubmit:w,validationSchema:Z,disabled:!L,initialValues:n||{autoRegister:!1,defaultRole:null,ssoLockedRoles:null},children:({modified:l,isSubmitting:u})=>s.jsxs(s.Fragment,{children:[s.jsx(p.Header,{primaryAction:s.jsx(_,{disabled:!l,loading:u,startIcon:s.jsx(V,{}),type:"submit",children:e({id:"global.save",defaultMessage:"Save"})}),title:e({id:"Settings.sso.title",defaultMessage:"Single Sign-On"}),subtitle:e({id:"Settings.sso.description",defaultMessage:"Configure the settings for the Single Sign-On feature."}),secondaryAction:s.jsx(q,{label:e({id:"components.premiumFeature.title",defaultMessage:"Premium feature"})})}),s.jsx(p.Content,{children:u||b?s.jsx(g.Loading,{}):s.jsxs($,{direction:"column",alignItems:"stretch",gap:4,background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:[s.jsx(z,{variant:"delta",tag:"h2",children:e({id:"global.settings",defaultMessage:"Settings"})}),s.jsx(x.Root,{gap:4,children:[{hint:e({id:"Settings.sso.form.registration.description",defaultMessage:"Create new user on SSO login if no account exists"}),label:e({id:"Settings.sso.form.registration.label",defaultMessage:"Auto-registration"}),name:"autoRegister",size:6,type:"boolean"},{hint:e({id:"Settings.sso.form.defaultRole.description",defaultMessage:"It will attach the new authenticated user to the selected role"}),label:e({id:"Settings.sso.form.defaultRole.label",defaultMessage:"Default role"}),name:"defaultRole",options:S.map(({id:a,name:r})=>({label:r,value:a.toString()})),placeholder:e({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),size:6,type:"enumeration"},{hint:e({id:"Settings.sso.form.localAuthenticationLock.description",defaultMessage:"Select the roles for which you want to disable the local authentication"}),label:e({id:"Settings.sso.form.localAuthenticationLock.label",defaultMessage:"Local authentication lock-out"}),name:"ssoLockedRoles",options:S.map(({id:a,name:r})=>({label:r,value:a.toString()})),placeholder:e({id:"components.InputSelect.option.placeholder",defaultMessage:"Choose here"}),size:6,type:"multi"}].map(({size:a,...r})=>s.jsx(x.Item,{col:a,direction:"column",alignItems:"stretch",children:s.jsx(Y,{...r})},r.name))})]})})]})})})]})},Y=e=>{switch(e.type){case"multi":return s.jsx(J,{...e});default:return s.jsx(G,{...e})}},J=({hint:e,label:t,name:o,options:m,...h})=>{const i=Q(o);return s.jsxs(c.Root,{name:o,hint:e,error:i.error,children:[s.jsx(c.Label,{children:t}),s.jsx(D,{onChange:n=>i.onChange("ssoLockedRoles",n),onClear:()=>i.onChange("ssoLockedRoles",[]),value:i.value??[],withTags:!0,...h,children:m.map(({label:n,value:d})=>s.jsx(N,{value:d,children:n},d))}),s.jsx(c.Hint,{}),s.jsx(c.Error,{})]})},se=()=>{const e=j(t=>t.admin_app.permissions.settings?.sso?.main);return s.jsx(g.Protect,{permissions:e,children:s.jsx(X,{})})};export{se as ProtectedSSO,X as SingleSignOnPage};
